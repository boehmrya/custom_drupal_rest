<?php

use Drupal\node\Entity\Node;

function article_block_get_content() {
  $nids = article_block_query();
  $nodes = Node::loadMultiple($nids);
  $view_builder = \Drupal::entityTypeManager()->getViewBuilder('node');
  $output_list = array();
  foreach ($nodes as $node) {
    $build = $view_builder->view($node, 'full');
    $node_output = \Drupal::service('renderer')->render($build);
    $output_list[] = $node_output;
  }
  return $output_list;
}

function article_block_query() {
  $content_types = array(
      'article',
      'video'
  );
  $state = \Drupal::request()->get('state');
  $query = \Drupal::entityQuery('node')
          ->condition('status', 1)
          ->condition('type', $content_types, 'IN')
          ->condition('field_states', 4);

  if ($state) {
    $and = $query->andConditionGroup()
            ->condition('field_states', $state);
    $query->condition($and);
  }

  $query->sort('created', 'DESC');
  $query->pager(6);
  $nids = $query->execute();
  return $nids;
}
